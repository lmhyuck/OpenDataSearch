<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>ê³µê³µë°ì´í„° ê²€ìƒ‰ ì—”ì§„</title>
    <link rel="stylesheet" href="/client/css/style.css" />
  </head>
  <body>
    <div class="search-container">
      <h1>ğŸ” ê³µê³µë°ì´í„° ê²€ìƒ‰</h1>
      <p>ìš°ë¦¬ë™ë„¤ ê³µê³µë°ì´í„° ë©”íƒ€ë°ì´í„°ë¥¼ ë¹ ë¥´ê²Œ ì°¾ì•„ë³´ì„¸ìš”</p>

      <form onsubmit="search(1); return false;">
        <input
          type="text"
          id="query"
          placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ë¯¸ì„¸ë¨¼ì§€)"
        />
        <button type="submit">ê²€ìƒ‰</button>
      </form>
    </div>

    <div id="results"></div>
    <div id="pagination" style="margin-top: 20px"></div>

    <script>
      let currentPage = 1;
      let currentQuery = "";

      async function search(page = 1) {
        const q = document.getElementById("query").value;
        if (!q) return;

        currentPage = page;
        currentQuery = q;

        const res = await fetch(`/search?q=${q}&page=${page}`);
        const json = await res.json();

        // 1. ê²°ê³¼ ì¶œë ¥
        const resultsDiv = document.getElementById("results");
        resultsDiv.innerHTML = `<p>ì´ <b>${json.total_found}</b>ê°œì˜ ê²°ê³¼ (í˜ì´ì§€: ${json.current_page}/${json.total_pages})</p>`;

        json.data.forEach((item) => {
          resultsDiv.innerHTML += `
                    <div class="item">
                        <div class="title">${item.title}</div>
                        <div class="desc">${item.desc}</div>
                        <div class="meta">ğŸ“ ${item.category} | ğŸ¢ ${item.org}</div>
                    </div>`;
        });

        // 2. í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼ ë§Œë“¤ê¸°
        renderPagination(json.total_pages);
      }

      function renderPagination(totalPages) {
        const nav = document.getElementById("pagination");
        nav.innerHTML = "";

        if (totalPages <= 1) return;

        // ì´ì „ ë²„íŠ¼
        if (currentPage > 1) {
          nav.innerHTML += `<button onclick="search(${
            currentPage - 1
          })">ì´ì „</button> `;
        }

        // í˜„ì¬ í˜ì´ì§€ í‘œì‹œ
        nav.innerHTML += `<span> ${currentPage} / ${totalPages} </span>`;

        // ë‹¤ìŒ ë²„íŠ¼
        if (currentPage < totalPages) {
          nav.innerHTML += ` <button onclick="search(${
            currentPage + 1
          })">ë‹¤ìŒ</button>`;
        }
      }
    </script>
  </body>
</html>
